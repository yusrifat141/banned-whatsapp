export default async function handler(req, res) {
    if (req.method !== "POST") {
        return res.status(405).json({ 
            success: false, 
            message: "Method not allowed" 
        });
    }

    const { text } = req.body;

    if (!text) {
        return res.status(400).json({ 
            success: false, 
            message: "Missing message text" 
        });
    }

    const apiKey = process.env.BREVO_API_KEY;

    if (!apiKey) {
        return res.status(500).json({
            success: false,
            message: "Missing API key in environment variables"
        });
    }

    try {
        const sendRes = await fetch("https://api.brevo.com/v3/smtp/email", {
            method: "POST",
            headers: {
                "accept": "application/json",
                "content-type": "application/json",
                "api-key": apiKey
            },
            body: JSON.stringify({
                sender: { 
                    name: "WhatsApp Appeal Bot", 
                    email: "no-reply@yourdomain.com" 
                },
                to: [
                    { email: "support@support.whatsapp.com" }
                ],
                subject: "WhatsApp Appeal Request",
                htmlContent: `<p>${text}</p>`
            })
        });

        const data = await sendRes.json();

        if (sendRes.ok) {
            return res.status(200).json({ 
                success: true, 
                message: "Email sent successfully" 
            });
        } else {
            return res.status(400).json({ 
                success: false, 
                message: data.message || "Email sending failed" 
            });
        }

    } catch (err) {
        return res.status(500).json({
            success: false,
            message: "Server error"
        });
    }
}
